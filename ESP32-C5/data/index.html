<!doctype html>
<html>
    <head>
        <meta charset='utf-8'>
        <title>ESP32-C5</title>
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <style>body{font-family:Arial,Helvetica,sans-serif;margin:12px;}img{border:1px solid #ddd;padding:4px;background:#fff}</style>
    </head>
    <body>
        <h1>HandTool Web Server</h1>
        <p><img src="https://raw.githubusercontent.com/vgroenhuis/HandTool/refs/heads/main/pics/HandTool_500px.jpg" alt="HandTool" style="max-width:100%;height:auto;"></p>
        <h2>External links</h2>
        <p><a href="https://github.com/vgroenhuis/HandTool" target="_blank">github.com/vgroenhuis/HandTool</a> Github repository with CAD files, sources, manual and assembly instructions</p>
        <h2>Links on this device</h2>
        <p><a href="/">/</a> This page</p>
        <p><a href="/index.html">/index.html</a> Also this page</p>
        <p><a href="/robotView.html">/robotView.html</a> Open Robot View (3D)</p>
        <p><a href="/angles">/angles</a> JSON structure with joint angles in degrees</p>
        <p><a href="/rawAdcValues">/rawAdcValues</a> JSON structure with raw ADC values</p>
        <p><a href="/fk">/fk</a> JSON structure with end-effector to robot coordinate transformation matrix</p>
        <h2>Joint angles (degrees)</h2>
        <div id="angles">Loading...</div>
        <h2>Analog inputs (low-pass filtered)</h2>
        <div id="adc">Loading...</div>

        <script>
            async function fetchValues(){
                try{
                    const r = await fetch('/rawAdcValues');
                    const j = await r.json();
                    const el = document.getElementById('adc');
                    let html = '<ul>';
                    for(let i=0;i<8;i++) html += `<li>CH${i}: ${j.values[i]}</li>`;
                    html += '</ul>';
                    el.innerHTML = html;
                }catch(e){ console.error(e); }
            }
            fetchValues();
            setInterval(fetchValues,100);

            async function fetchAngles(){
                try{
                    const r = await fetch('/angles');
                    if(!r.ok) return;
                    const j = await r.json();
                    const a = Array.isArray(j.angles) ? j.angles : [];
                    const el = document.getElementById('angles');
                    if(a.length >= 6){
                        el.innerHTML = `<ul>
                            <li>J1: ${Number(a[0]).toFixed(2)}&deg;</li>
                            <li>J2: ${Number(a[1]).toFixed(2)}&deg;</li>
                            <li>J3: ${Number(a[2]).toFixed(2)}&deg;</li>
                            <li>J4: ${Number(a[3]).toFixed(2)}&deg;</li>
                            <li>J5: ${Number(a[4]).toFixed(2)}&deg;</li>
                            <li>J6: ${Number(a[5]).toFixed(2)}&deg;</li>
                        </ul>`;
                    } else {
                        el.textContent = 'Angles unavailable';
                    }
                }catch(e){ /* ignore transient errors */ }
            }
            fetchAngles();
            setInterval(fetchAngles, 100);
        </script>
    </body>
</html>
